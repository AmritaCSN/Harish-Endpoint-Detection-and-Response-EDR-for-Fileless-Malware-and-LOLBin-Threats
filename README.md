# Endpoint Detection and Response EDR for Fileless Malware and LOLBin Threats

This repository contains Python scripts for monitoring process, file, and registry events using YARA rules. These scripts help detect suspicious activities used by fileless malware and Living-off-the-Land Binaries(LOLBin) on a Windows system by matching events against predefined YARA rules.


## Overview

The monitoring scripts are divided into three categories:

1. 	**Process Event Monitoring:** Monitors running processes and checks if any process matches the YARA rules.
2.	**File Event Monitoring:** Monitors file system changes and alerts if any file matches the YARA rules. 
3.	**Registry Event Monitoring:** Monitors registry key changes and alerts if any key matches the YARA rules.

## Project Structure

- `monitor_process_events.py`: Script for monitoring process events and matching them with YARA rules.
- `monitor_file_changes.py`: Script for monitoring file system changes and matching them with YARA rules.
- `monitor_registry_changes.py`: Script for monitoring registry key changes and matching them with YARA rules.
- `Yara_rule/`: Directory containing YARA rule files (`.yar` or `.yara`) used by the monitoring scripts.

## Setup and Usage

### Prerequisites

- Python 3.11.9
- Required Python packages: 'psutil', 'yara-python', 'watchdog', 'winregistry'

### Installation

1. Clone this repository to your local machine.
2. Ensure that the required Python packages are installed. You can install them using pip: 
  
  ```sh
  pip install psutil yara-python watchdog winregistry
  ```

### Configuration

1.	Define your YARA rules in separate files with .yar or .yara extensions. 
2.	Place these rule files in a folder. Update the paths to the YARA rules folders in each monitoring script:
     - 	For process event monitoring: Update the 'rules_folder' variable in the monitor_process_events.py script. 
	   -  For file event monitoring: Update the 'yara_rules_folder' variable in the monitor_file_changes.py script.
	   -  For registry event monitoring: Update the 'yara_rules_folder' variable in the monitor_registry_changes.py script.


### How itâ€™s Work

The Block Diagram illustrates the process flow of the script as it begins monitoring Process, File, and Registry Events. It collects information and checks it against defined YARA rules. If any event matches a YARA rule, a notification is triggered indicating the matched YARA rule.
 
<div align="center">
    <img src="https://github.com/AmritaCSN/Harish-Endpoint-Detection-and-Response-EDR-for-Fileless-Malware-and-LOLBin-Threats/assets/120771272/19e2d532-3f0e-47e7-8a21-f847cb4f2d93" alt="Blockdiagram_2" width="600"/>
</div>


### Usage 

**Note:** Run the scripts with Administrator privileges to avoid 'Access denied' errors.

-	To start monitoring process events, run the monitor_process_events.py script. 
-	To start monitoring file events, run the monitor_file_changes.py script.
-	To start monitoring registry events, run the monitor_registry_changes.py script.

