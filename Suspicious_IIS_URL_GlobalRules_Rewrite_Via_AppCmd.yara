rule Suspicious_IIS_URL_GlobalRules_Rewrite_Via_AppCmd {
    meta:
        description = "Detects usage of 'appcmd' to create new global URL rewrite rules"
        author = "Nasreddine Bencherchali (Nextron Systems)"
        date = "2023/01/22"
        status = "test"
        tags = "attack.defense_evasion"
        references = "https://twitter.com/malmoeb/status/1616702107242971144, https://learn.microsoft.com/en-us/answers/questions/739120/how-to-add-re-write-global-rule-with-action-type-r"
    strings:
        $appcmd_url_rewrite = /.*appcmd\.exe.*set.*config.*section:system\.webServer\/rewrite\/globalRules.*commit:.*/ nocase
    condition:
        $appcmd_url_rewrite
}
