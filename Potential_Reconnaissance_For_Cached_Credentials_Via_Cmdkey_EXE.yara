rule Potential_Reconnaissance_For_Cached_Credentials_Via_Cmdkey_EXE {
    meta:
        description = "Detects usage of cmdkey to look for cached credentials on the system."
        author = "jmallette, Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)"
        date = "2019/01/16"
        status = "test"
        tags = "attack.credential_access, attack.t1003.005, level.high"
    strings:
        $cmdkey_exe = "cmdkey.exe" wide
        $cmdline_strings = " /l" wide ascii nocase
        $cmdline_strings2 = " -l" wide ascii nocase
    condition:
        $cmdkey_exe at 0 and any of ($cmdline_strings, $cmdline_strings2)
}
