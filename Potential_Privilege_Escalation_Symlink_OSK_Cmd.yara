rule Potential_Privilege_Escalation_Symlink_OSK_Cmd {
    meta:
        description = "Detects the creation of a symbolic link between 'cmd.exe' and the accessibility on-screen keyboard binary (osk.exe) using 'mklink'."
        author = "frack113"
        date = "2022/12/11"
        modified = "2022/12/20"
        reference = "https://github.com/redcanaryco/atomic-red-team/blob/5c1e6f1b4fafd01c8d1ece85f510160fc1275fbf/atomics/T1546.008/T1546.008.md"
        status = "test"
        tags = "attack.privilege_escalation, attack.persistence, attack.t1546.008, level.high"
    strings:
        $mklink_pattern = "mklink" wide
        $osk_pattern = "\\osk.exe" wide
        $cmd_pattern = "\\cmd.exe" wide
    condition:
        all of ($mklink_pattern, $osk_pattern, $cmd_pattern)
}
