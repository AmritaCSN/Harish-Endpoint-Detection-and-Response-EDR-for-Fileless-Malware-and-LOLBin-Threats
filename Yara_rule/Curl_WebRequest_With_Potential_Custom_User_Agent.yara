rule Curl_WebRequest_With_Potential_Custom_User_Agent {
    meta:
        description = "Detects execution of curl.exe with a potential custom User-Agent."
        author = "Nasreddine Bencherchali (Nextron Systems)"
        date = "2023/07/27"
        status = "experimental"
        tags = "attack.execution, level.medium"
    strings:
        $curl_exe_str = "curl.exe" wide
        $curl_cmdline_flag_H_str = /\s-H\s/ wide
        $curl_cmdline_user_agent_str = /User-Agent:/ wide
    condition:
        $curl_exe_str at (uint32(@curl_exe_str) - 4) and
        (
            $curl_cmdline_flag_H_str and
            $curl_cmdline_user_agent_str
        )
}
