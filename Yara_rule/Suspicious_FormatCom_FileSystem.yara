rule Suspicious_FormatCom_FileSystem {
    meta:
        description = "Detects the execution of format.com with a suspicious filesystem selection"
        author = "Florian Roth (Nextron Systems)"
        date = "2022/01/04"
        status = "test"
        tags = "attack.defense_evasion"
        references = "https://twitter.com/0gtweet/status/1477925112561209344"
    strings:
        $formatcom_exe = "format.com" wide ascii
        $fs_option = "/fs:" wide ascii
        $supported_fs = "/fs:FAT" wide ascii
        $supported_fs2 = "/fs:exFAT" wide ascii
        $supported_fs3 = "/fs:NTFS" wide ascii
        $supported_fs4 = "/fs:UDF" wide ascii
        $supported_fs5 = "/fs:ReFS" wide ascii
    condition:
        all of ($formatcom_exe, $fs_option) and (
            (not $supported_fs) or
            (not $supported_fs2) or
            (not $supported_fs3) or
            (not $supported_fs4) or
            (not $supported_fs5)
        )
}
