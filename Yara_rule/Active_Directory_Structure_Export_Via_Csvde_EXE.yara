rule Active_Directory_Structure_Export_Via_Csvde_EXE {
    meta:
        description = "Detects the execution of csvde.exe in order to export organizational Active Directory structure."
        author = "Nasreddine Bencherchali (Nextron Systems)"
        date = "2023/03/14"
        status = "test"
        tags = "attack.exfiltration, level.medium"
    strings:
        $csvde_exe_str = "csvde.exe" wide
        $csvde_cmdline_export_str = " -f" wide
        $csvde_cmdline_import_str = " -i" wide
    condition:
        (
            $csvde_exe_str at (uint32(@csvde_exe_str) - 4) and
            (
                $csvde_cmdline_export_str at (uint32(@csvde_cmdline_export_str) - 4) and
                not $csvde_cmdline_import_str at (uint32(@csvde_cmdline_import_str) - 4)
            )
        )
}
