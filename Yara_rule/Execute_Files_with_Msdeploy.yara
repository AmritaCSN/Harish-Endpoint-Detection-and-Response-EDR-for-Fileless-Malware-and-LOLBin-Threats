rule Execute_Files_with_Msdeploy {
    meta:
        description = "Detects file execution using the msdeploy.exe LOLBIN"
        author = "Beyu Denis, oscd.community"
        date = "2020/10/18"
        modified = "2021/11/27"
        status = "test"
        tags = "attack.execution, attack.t1218"
        references = "https://lolbas-project.github.io/lolbas/OtherMSBinaries/Msdeploy/, https://twitter.com/pabraeken/status/995837734379032576, https://twitter.com/pabraeken/status/999090532839313408"
    strings:
        $msdeploy_exe = "msdeploy.exe" wide ascii
        $command_line_1 = "verb:sync" wide ascii
        $command_line_2 = "-source:RunCommand" wide ascii
        $command_line_3 = "-dest:runCommand" wide ascii
    condition:
        $msdeploy_exe at 0 and
        $command_line_1 at 0 and
        $command_line_2 at 0 and
        $command_line_3 at 0
}
