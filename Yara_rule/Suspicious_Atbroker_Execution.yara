rule Suspicious_Atbroker_Execution
{
    meta:
        description = "Atbroker executing non-default Assistive Technology applications"
        id = "f24bcaea-0cd1-11eb-adc1-0242ac120002"
        status = "test"
        references = "http://www.hexacorn.com/blog/2016/07/22/beyond-good-ol-run-key-part-42/, https://lolbas-project.github.io/lolbas/Binaries/Atbroker/"
        author = "Mateusz Wydra, oscd.community"
        date = "2020/10/12"
        modified = "2022/10/09"
        tags = "attack.defense_evasion, attack.t1218"
        level = "high"

    strings:
        $image_endswith_atbroker = "AtBroker.exe"
        $cmdline_contains_start = "start"
        $filter_keywords = "animations audiodescription caretbrowsing caretwidth colorfiltering cursorscheme filterkeys focusborderheight focusborderwidth highcontrast keyboardcues keyboardpref magnifierpane messageduration minimumhitradius mousekeys Narrator osk overlappedcontent showsounds soundsentry stickykeys togglekeys windowarranging windowtracking windowtrackingtimeout windowtrackingzorder"

    condition:
        $image_endswith_atbroker and
        $cmdline_contains_start and
        (
            not any of ($filter_keywords) 
        )
}
