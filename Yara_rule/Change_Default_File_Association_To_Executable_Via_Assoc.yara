rule Change_Default_File_Association_To_Executable_Via_Assoc {
    meta:
        description = "Detects when a program changes the default file association of any extension to an executable."
        author = "Nasreddine Bencherchali (Nextron Systems)"
        date = "2022/06/28"
        modified = "2023/03/06"
        reference = "https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/assoc"
        status = "test"
        tags = "attack.persistence, attack.t1546.001, level.high"
    strings:
        $assocCmd = "assoc"
        $cmdExe = "\\cmd.exe"
        $assocChange = "exefile"
    condition:
        $assocCmd at (uint16(0)) and
        $cmdExe at (uint16(2)) and
        $assocChange at (uint16(2)) and
        all of them
}
