rule Potential_Cookies_Session_Hijacking {
    meta:
        description = "Detects execution of curl.exe with the -c flag in order to save cookie data."
        author = "Nasreddine Bencherchali (Nextron Systems)"
        date = "2023/07/27"
        status = "experimental"
        tags = "attack.execution, level.medium"
    strings:
        $curl_exe_str = "curl.exe" wide
        $curl_cmdline_flag_c_str = /\s-c\s/ wide
        $curl_cmdline_cookie_jar_str = /--cookie-jar/ wide
    condition:
        $curl_exe_str at (uint32(@curl_exe_str) - 4) and
        (
            $curl_cmdline_flag_c_str or
            $curl_cmdline_cookie_jar_str
        )
}
