rule Potential_Dosfuscation_Activity {
    meta:
        description = "Detects possible payload obfuscation via the commandline"
        author = "frack113, Nasreddine Bencherchali (Nextron Systems)"
        date = "2022/02/15"
        modified = "2023/03/06"
        reference = "https://www.fireeye.com/content/dam/fireeye-www/blog/pdfs/dosfuscation-report.pdf"
        reference = "https://github.com/danielbohannon/Invoke-DOSfuscation"
        status = "test"
        tags = "attack.execution, attack.t1059, level.medium"
    strings:
        $pattern1 = "^^"
        $pattern2 = "^|^"
        $pattern3 = ",;,"
        $pattern4 = ";;;;"
        $pattern5 = ";; ;;"
        $pattern6 = "(,(,"
        $pattern7 = "%COMSPEC:~"
        $pattern8 = " c^m^d"
        $pattern9 = "^c^m^d"
        $pattern10 = " c^md"
        $pattern11 = " cm^d"
        $pattern12 = "^cm^d"
        $pattern13 = " s^et "
        $pattern14 = " s^e^t "
        $pattern15 = " se^t "
        $pattern16 = "%%"
        $pattern17 = "&&"
        $pattern18 = "\"\""
    condition:
        any of them
}
