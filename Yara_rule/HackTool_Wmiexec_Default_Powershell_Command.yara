rule HackTool_Wmiexec_Default_Powershell_Command {
    meta:
        description = "Detects the execution of PowerShell with a specific flag sequence used by the Wmiexec script."
        author = "Nasreddine Bencherchali (Nextron Systems)"
        date = "2023/03/08"
        status = "test"
        tags = "attack.defense_evasion, attack.lateral_movement"
        references = "https://github.com/fortra/impacket/blob/f4b848fa27654ca95bc0f4c73dbba8b9c2c9f30a/examples/wmiexec.py"
    strings:
        $hacktool_wmiexec_flags = "-NoP -NoL -sta -NonI -W Hidden -Exec Bypass -Enc"
    condition:
        $hacktool_wmiexec_flags
}
