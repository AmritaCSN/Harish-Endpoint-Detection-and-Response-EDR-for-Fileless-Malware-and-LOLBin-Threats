rule File_Deletion_Via_Del {
    meta:
        description = "Detects execution of the builtin 'del'/'erase' commands in order to delete files."
        author = "frack113"
        date = "2022/01/15"
        modified = "2023/03/06"
        reference = "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1070.004/T1070.004.md"
        status = "test"
        tags = "attack.defense_evasion, attack.t1070.004, level.low"
    strings:
        $cmdExe = "\\cmd.exe"
        $delCommand = "del "
        $eraseCommand = "erase "
        $forceFlag = " /f"
        $subdirectoriesFlag = " /s"
        $quietModeFlag = " /q"
    condition:
        $cmdExe at (uint16(0)) and
        ($delCommand at (uint16(2)) or $eraseCommand at (uint16(2))) and
        (
            $forceFlag at (uint16(2)) or
            $subdirectoriesFlag at (uint16(2)) or
            $quietModeFlag at (uint16(2))
        )
}
