rule Copy_DMP_DUMP_Files_From_Remote_Share_Via_Cmd_EXE {
    meta:
        description = "Detects usage of the copy builtin cmd command to copy files with the '.dmp'/''.dump' extension from a remote share"
        author = "Nasreddine Bencherchali (Nextron Systems)"
        date = "2022/09/27"
        modified = "2023/09/12"
        reference = "https://thedfirreport.com/2022/09/26/bumblebee-round-two/"
        status = "experimental"
        tags = "attack.credential_access, level.high"
    strings:
        $cmdExe = "\\cmd.exe"
        $copyCmd = "copy "
        $remoteShare = " \\\\"
        $dmpExtension = ".dmp"
        $dumpExtension = ".dump"
        $hdmpExtension = ".hdmp"
    condition:
        $cmdExe at (uint16(0)) and
        $copyCmd at (uint16(2)) and
        $remoteShare at (uint16(2)) and
        (
            $dmpExtension at (uint16(2)) or
            $dumpExtension at (uint16(2)) or
            $hdmpExtension at (uint16(2))
        )
}
