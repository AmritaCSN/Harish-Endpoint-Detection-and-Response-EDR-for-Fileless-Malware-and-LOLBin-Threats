rule MpiExec_Lolbin {
    meta:
        description = "Detects a certain command line flag combination used by mpiexec.exe LOLBIN from HPC pack that can be used to execute any other binary"
        author = "Florian Roth (Nextron Systems)"
        date = "2022/01/11"
        status = "test"
        tags = "attack.execution, attack.defense_evasion, attack.t1218"
        references = "https://twitter.com/mrd0x/status/1465058133303246867, https://docs.microsoft.com/en-us/powershell/high-performance-computing/mpiexec?view=hpc19-ps"
    strings:
        $mpiexec_exe = "mpiexec.exe" wide ascii
        $imphash = "d8b52ef6aaa3a81501bdfff9dbb96217" wide ascii
        $flags = " /n 1 " wide ascii
    condition:
        $mpiexec_exe at 0 and $imphash at 0 and $flags at 0 and all of them
}
