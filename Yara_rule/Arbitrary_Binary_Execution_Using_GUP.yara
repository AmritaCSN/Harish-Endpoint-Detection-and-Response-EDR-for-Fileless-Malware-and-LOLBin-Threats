rule Arbitrary_Binary_Execution_Using_GUP_Utility 
{
    meta:
        description = "Detects execution of the Notepad++ updater (gup) to launch other commands or executables"
        author = "Nasreddine Bencherchali (Nextron Systems)"
        date = "2022/06/10"
        modified = "2023/03/02"
        status = "test"
        tags = "attack.execution, level.medium"
        references = "https://twitter.com/nas_bench/status/1535322445439180803"
    strings:
        $gup_executable = "gup.exe" wide
        $explorer_executable = "explorer.exe" wide
        $notepad_path = "\\Notepad++\\notepad++.exe" wide
        $updater_path = "\\Notepad++\\updater\\" wide
    condition:
        uint16(0) == 0x5A4D and
        $gup_executable at 0 and
        $explorer_executable at 0 and
       all of them
}