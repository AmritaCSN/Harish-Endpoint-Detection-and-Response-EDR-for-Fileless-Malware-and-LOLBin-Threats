rule PowerShell_DownloadFile {
    meta:
        description = "Detects the execution of PowerShell, a WebClient object creation, and the invocation of DownloadFile in a single command line"
        author = "Florian Roth (Nextron Systems)"
        date = "2020/08/28"
        modified = "2021/11/27"
        references = "https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html"
        tags = "attack.execution, attack.t1059.001, attack.command_and_control, attack.t1104, attack.t1105"
        level = "high"

    strings:
        $powershell = "powershell"
        $downloadFile = ".DownloadFile"
        $webClient = "System.Net.WebClient"

    condition:
        all of them
}
