rule XBAP_Execution_From_Uncommon_Locations_Via_PresentationHost {
    meta:
        description = "Detects execution of .xbap files from uncommon locations via PresentationHost.exe"
        author = "Nasreddine Bencherchali (Nextron Systems)"
        date = "2022/07/01"
        modified = "2023/11/09"
        references = "https://lolbas-project.github.io/lolbas/Binaries/Presentationhost/"
        tags = "attack.defense_evasion, attack.execution, attack.t1218"
        level = "medium"

    strings:
        $presentationHost = "PresentationHost.exe"
        $xbapExtension = ".xbap"

    condition:
        $presentationHost at 0 and $xbapExtension and not (
            / C:\\Windows\\ / or / C:\\Program Files /
        )
}
