rule Invoke_Obfuscation_COMPRESS_OBFUSCATION {
    meta:
        description = "Detects Obfuscated Powershell via COMPRESS OBFUSCATION"
        author = "Timur Zinniatullin, oscd.community"
        date = "2020/10/18"
        modified = "2022/12/29"
        status = "test"
        tags = "attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001"
        references = "https://github.com/SigmaHQ/sigma/issues/1009"
    strings:
        $compress_obfuscation_1 = /new-object.*text\.encoding\]::ascii.*system\.io\.compression\.deflatestream.*system\.io\.streamreader.*readtoend\(/
    condition:
        all of them
}
