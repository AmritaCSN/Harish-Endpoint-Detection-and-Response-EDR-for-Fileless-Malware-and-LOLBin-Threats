rule NtdllPipe_Like_Activity_Execution {
    meta:
        description = "Detects command that type the content of ntdll.dll to a different file or a pipe."
        author = "Florian Roth (Nextron Systems)"
        date = "2022/03/05"
        modified = "2023/03/07"
        reference = "https://web.archive.org/web/20220306121156/https://www.x86matthew.com/view_post?id=ntdll_pipe"
        status = "test"
        tags = "attack.defense_evasion, level.high"
    strings:
        $ntdll_type_cmd1 = "type %windir%\\system32\\ntdll.dll" wide
        $ntdll_type_cmd2 = "type %systemroot%\\system32\\ntdll.dll" wide
        $ntdll_type_cmd3 = "type c:\\windows\\system32\\ntdll.dll" wide
        $ntdll_pipe_cmd = "\\\\ntdll.dll > \\\\\\\\\\.\\\\pipe\\\\" wide
    condition:
        any of ($ntdll_type_cmd1, $ntdll_type_cmd2, $ntdll_type_cmd3, $ntdll_pipe_cmd)
}
