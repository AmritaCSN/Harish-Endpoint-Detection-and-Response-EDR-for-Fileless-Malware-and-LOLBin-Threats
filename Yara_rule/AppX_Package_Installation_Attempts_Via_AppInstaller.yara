rule AppX_Package_Installation_Attempts_Via_AppInstaller
{
    meta:
        description = "Detects AppInstaller.exe spawned by the default handler for the 'ms-appinstaller' URI attempting to load/install a package from the referenced URL"
        id = "7cff77e1-9663-46a3-8260-17f2e1aa9d0a"
        status = "test"
        references = "https://twitter.com/notwhickey/status/1333900137232523264 https://lolbas-project.github.io/lolbas/Binaries/AppInstaller/"
        author = "frack113"
        date = "2021/11/24"
        modified = "2023/01/12"
        tags = "attack.command_and_control, attack.t1105"
        level = "medium"

    strings:
        $image_starts_with = "C:\\Program Files\\WindowsApps\\Microsoft.DesktopAppInstaller_" nocase
        $image_ends_with = "\\AppInstaller.exe" nocase

    condition:
        $image_starts_with and $image_ends_with
}
