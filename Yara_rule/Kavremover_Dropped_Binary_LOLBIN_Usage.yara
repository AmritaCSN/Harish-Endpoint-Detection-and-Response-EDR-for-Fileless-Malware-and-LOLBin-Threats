rule Kavremover_Dropped_Binary_LOLBIN_Usage {
    meta:
        description = "Detects the execution of a signed binary dropped by Kaspersky Lab Products Remover (kavremover) which can be abused as a LOLBIN"
        author = "Nasreddine Bencherchali (Nextron Systems)"
        date = "2022/11/01"
        status = "test"
        tags = "attack.defense_evasion, attack.t1127"
        references = "https://nasbench.medium.com/lolbined-using-kaspersky-endpoint-security-kes-installer-to-execute-arbitrary-commands-1c999f1b7fea"
    strings:
        $kavremover_exe = "kavremover.exe" wide ascii
        $cleanapi_exe = "cleanapi.exe" wide ascii
        $run_cmd = " run run-cmd " wide ascii
    condition:
        $run_cmd at 0 and (($kavremover_exe at (uint16(0)) and not $cleanapi_exe) or $cleanapi_exe)
}
