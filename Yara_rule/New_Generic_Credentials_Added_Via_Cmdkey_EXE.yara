rule New_Generic_Credentials_Added_Via_Cmdkey_EXE {
    meta:
        description = "Detects usage of cmdkey to add generic credentials."
        author = "frack113, Nasreddine Bencherchali (Nextron Systems)"
        date = "2023/02/03"
        status = "test"
        tags = "attack.credential_access, attack.t1003.005, level.medium"
    strings:
        $cmdkey_exe = "cmdkey.exe" wide
        $cmdline_strings = " /g" wide ascii nocase
        $cmdline_strings2 = " /u" wide ascii nocase
        $cmdline_strings3 = " /p" wide ascii nocase
    condition:
        $cmdkey_exe at 0 and all of ($cmdline_strings, $cmdline_strings2, $cmdline_strings3)
}
