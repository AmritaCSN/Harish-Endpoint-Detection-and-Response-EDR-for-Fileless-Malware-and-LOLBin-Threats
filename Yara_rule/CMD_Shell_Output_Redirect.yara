rule CMD_Shell_Output_Redirect {
    meta:
        description = "Detects the use of the redirection character '>' to redirect information in command line"
        author = "frack113"
        date = "2022/01/22"
        modified = "2023/03/07"
        status = "test"
        tags = "attack.discovery, attack.t1082, level.low"
    strings:
        $cmd_exe_path = "cmd.exe" wide
        $output_redirect = ">" wide
        $idm_executable = "C:\\Program Files (x86)\\Internet Download Manager\\IDMMsgHost.exe" wide
        $chrome_extension = "chrome-extension://" wide
        $chrome_native_messaging = "\\\\.\\pipe\\chrome.nativeMessaging" wide
    condition:
        all of ($cmd_exe_path, $output_redirect) and not (
            1 of ($idm_executable, $chrome_extension, $chrome_native_messaging)
        )
}
