rule Copy_From_VolumeShadowCopy_Via_Cmd_EXE {
    meta:
        description = "Detects the execution of the builtin 'copy' command that targets a shadow copy"
        author = "Max Altgelt (Nextron Systems), Tobias Michalski (Nextron Systems)"
        date = "2021/08/09"
        modified = "2023/03/07"
        status = "test"
        tags = "attack.impact, attack.t1490, level.high"
    strings:
        $cmd_exe_path = "cmd.exe" wide
        $copy_command = "copy" wide
        $shadow_copy_path = "\\\\?\\GLOBALROOT\\Device\\HarddiskVolumeShadowCopy" wide
    condition:
        $cmd_exe_path at 0 and
        $copy_command at 1 and
        $shadow_copy_path at 2
}
