rule DNS_ServerLevelPluginDll_Installed_Via_Dnscmd_EXE {
    meta:
        description = "Detects the installation of a DNS plugin DLL via ServerLevelPluginDll parameter in registry."
        author = "Florian Roth (Nextron Systems)"
        date = "2017/05/08"
        modified = "2023/02/05"
        status = "test"
        tags = "attack.defense_evasion, attack.t1574.002, attack.t1112, level.high"
    strings:
        $dnscmd_exe = "dnscmd.exe" wide
        $config = "/config" wide
        $serverlevelplugindll = "/serverlevelplugindll" wide
    condition:
        (uint16(0) == 0x5A4D) and
        ($dnscmd_exe at 0) and
        all of ($config, $serverlevelplugindll)
}
