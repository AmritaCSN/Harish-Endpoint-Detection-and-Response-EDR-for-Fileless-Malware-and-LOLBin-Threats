rule Invoke_Obfuscation_Via_Use_MSHTA {
    meta:
        description = "Detects Obfuscated Powershell via use MSHTA in Scripts"
        author = "Nikita Nazarov, oscd.community"
        date = "2020/10/08"
        modified = "2022/03/08"
        status = "test"
        tags = "attack.defense_evasion, attack.t1027, attack.execution, attack.t1059.001"
        references = "https://github.com/SigmaHQ/sigma/issues/1009"
    strings:
        $invoke_obfuscation_mshta_1 = /set.*&&.*mshta.*vbscript:createobject.*\.run.*\(window\.close\)/
    condition:
        all of them
}
