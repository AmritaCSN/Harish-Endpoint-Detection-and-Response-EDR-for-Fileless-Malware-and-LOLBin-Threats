rule Boot_Configuration_Tampering_Via_Bcdedit {
    meta:
        description = "Detects the use of bcdedit command to tamper with the boot configuration data"
        author = "E.M. Anhaus, oscd.community"
        date = "2023-02-15"
        reference = "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1490/T1490.md"
    strings:
        $bcdedit_path = "*\\bcdedit.exe"
        $set_command = "set"
        $bootstatuspolicy_ignoreallfailures = "bootstatuspolicy ignoreallfailures"
        $recoveryenabled_no = "recoveryenabled no"
    condition:
        $bcdedit_path at 0 and
        $set_command at 1 and
        ($bootstatuspolicy_ignoreallfailures or $recoveryenabled_no)
}
