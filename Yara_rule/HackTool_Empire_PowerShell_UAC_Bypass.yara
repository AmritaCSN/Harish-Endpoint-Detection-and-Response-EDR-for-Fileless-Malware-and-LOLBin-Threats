rule HackTool_Empire_PowerShell_UAC_Bypass {
    meta:
        description = "Detects some Empire PowerShell UAC bypass methods"
        author = "Ecco"
        date = "2019/08/30"
        modified = "2023/02/21"
        status = "stable"
        tags = "attack.defense_evasion, attack.privilege_escalation, attack.t1548.002, car.2019-04-001"
        references = "https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-EventVwrBypass.ps1#L64, https://github.com/EmpireProject/Empire/blob/e37fb2eef8ff8f5a0a689f1589f424906fe13055/data/module_source/privesc/Invoke-FodHelperBypass.ps1#L64"
    strings:
        $empire_uac_bypass = / -NoP -NonI -w Hidden -c \$x=\(\(gp HKCU:Software\\Microsoft\\Windows Update\).Update\) | -NoP -NonI -c \$x=\(\(gp HKCU:Software\\Microsoft\\Windows Update\).Update\);/
    condition:
        $empire_uac_bypass
}
