rule Suspicious_CustomShellHost_Execution {
    meta:
        description = "Detects the execution of CustomShellHost binary where the child isn't located in 'C:\\Windows\\explorer.exe'"
        author = "Nasreddine Bencherchali (Nextron Systems)"
        date = "2022/08/19"
        status = "test"
        tags = "attack.defense_evasion, attack.t1216"
        references = "https://github.com/LOLBAS-Project/LOLBAS/pull/180, https://lolbas-project.github.io/lolbas/Binaries/CustomShellHost/"
    strings:
        $custom_shell_host_exe = "\\CustomShellHost.exe" wide
        $windows_explorer_exe = "C:\\Windows\\explorer.exe" wide
    condition:
        $custom_shell_host_exe at 0 and not $windows_explorer_exe at 0
}
