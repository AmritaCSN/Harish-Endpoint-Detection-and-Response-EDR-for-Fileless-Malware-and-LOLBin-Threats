rule Remote_File_Download_Findstr {
    meta:
        description = "Detects execution of findstr with specific flags and a remote share path for potential remote file download"
        author = "Furkan CALISKAN, Nasreddine Bencherchali (Nextron Systems)"
        date = "2020/10/05"
        modified = "2023/11/12"
        status = "experimental"
        tags = "attack.defense_evasion, attack.t1218, attack.t1564.004, attack.t1552.001, attack.t1105, level.medium"
    strings:
        $findstr_path = "findstr.exe" wide
        $cli_download_1 = /(\s\/v\s|\s-v\s)/ wide
        $cli_download_2 = /(\s\/l\s|\s-l\s)/ wide
        $cli_download_3 = /\\\\/ wide
    condition:
        uint16(0) == 0x5A4D and
        $findstr_path at 0 and
        $cli_download_1 and
        $cli_download_2 and
        $cli_download_3
}
