rule Files_And_Subdirectories_Listing_Using_Dir {
    meta:
        description = "Detects usage of the 'dir' command that is part of Windows batch/cmd to collect information about directories."
        author = "frack113"
        date = "2021/12/13"
        modified = "2023/03/07"
        reference = "https://github.com/redcanaryco/atomic-red-team/blob/f339e7da7d05f6057fdfcdd3742bfcf365fee2a9/atomics/T1217/T1217.md"
        status = "test"
        tags = "attack.discovery, attack.t1217, level.low"
    strings:
        $dirCommand = "dir "
        $option1 = " /s"
        $option2 = " /b"
    condition:
        $dirCommand at (uint16(0)) and
        $option1 at (uint16(4)) and
        $option2 at (uint16(7))
}
