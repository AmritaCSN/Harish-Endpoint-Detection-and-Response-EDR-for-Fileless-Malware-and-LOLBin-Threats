rule Potential_Reconnaissance_For_Cached_Credentials_Via_Cmdkey_EXE {
    meta:
        description = "Detects usage of cmdkey to look for cached credentials on the system"
        author = "jmallette, Florian Roth (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)"
        date = "2019/01/16"
        modified = "2023/02/03"
        tags = "attack.credential_access, attack.t1003.005"
        level = "high"

    strings:
        $cmdkeyImage = "*\\cmdkey.exe" wide ascii
        $cmdkeyCli1 = " /l" wide ascii
        $cmdkeyCli2 = " -l" wide ascii

    condition:
          $cmdkeyImage and ($cmdkeyCli1 or $cmdkeyCli2)
}