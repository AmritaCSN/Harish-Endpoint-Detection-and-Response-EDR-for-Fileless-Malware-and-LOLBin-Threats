rule Potential_Discovery_Activity_Via_Dnscmd_EXE {
    meta:
        description = "Detects an attempt to leverage dnscmd.exe to enumerate the DNS zones of a domain."
        author = "@gott_cyber"
        date = "2022/07/31"
        modified = "2023/02/04"
        status = "test"
        tags = "attack.discovery, attack.execution, attack.t1543.003, level.medium"
    strings:
        $dnscmd_exe = "dnscmd.exe" wide
        $enumrecords = "/enumrecords" wide
        $enumzones = "/enumzones" wide
        $zoneprint = "/ZonePrint" wide
        $info = "/info" wide
    condition:
        (uint16(0) == 0x5A4D) and
        ($dnscmd_exe at 0) and
        any of ($enumrecords, $enumzones, $zoneprint, $info)
}
