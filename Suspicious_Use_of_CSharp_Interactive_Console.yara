rule Suspicious_Use_of_CSharp_Interactive_Console {
    meta:
        description = "Detects the execution of CSharp interactive console by PowerShell."
        author = "Michael R. (@nahamike01)"
        date = "2020/03/08"
        modified = "2022/07/14"
        status = "test"
        tags = "attack.execution, attack.t1127, level.high"
    strings:
        $csi_exe_str = "csi.exe" wide
        $powershell_str = "powershell.exe" wide
        $pwsh_str = "pwsh.exe" wide
        $powershell_ise_str = "powershell_ise.exe" wide
    condition:
        (
            $csi_exe_str at (uint32(@csi_exe_str) - 4) and
            (
                $powershell_str at (uint32(@powershell_str) - 4) or
                $pwsh_str at (uint32(@pwsh_str) - 4) or
                $powershell_ise_str at (uint32(@powershell_ise_str) - 4)
            )
        )
}
