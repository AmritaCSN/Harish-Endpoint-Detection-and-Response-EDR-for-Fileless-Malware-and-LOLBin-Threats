rule Potential_Process_Injection_Via_Msra_EXE {
    meta:
        description = "Detects potential process injection via Microsoft Remote Assistance (Msra.exe)"
        references = "https://www.microsoft.com/security/blog/2021/12/09/a-closer-look-at-qakbots-latest-building-blocks-and-how-to-knock-them-down/, https://www.fortinet.com/content/dam/fortinet/assets/analyst-reports/ar-qakbot.pdf"
        author = "Alexander McDonald"
        date = "2022/06/24"
        modified = "2023/02/03"
        tags = "attack.defense_evasion, attack.t1055"
        status = "test"
        level = "high"

    strings:
        $msra_process = "msra.exe" wide ascii
        $suspicious_child_processes = /arp\.exe|cmd\.exe|net\.exe|netstat\.exe|nslookup\.exe|route\.exe|schtasks\.exe|whoami\.exe/ wide ascii

    condition:
        $msra_process at 0 and $suspicious_child_processes
}
